@model IEnumerable<Inspinia_MVC5_SeedProject.Models.AspNetUser>

@{
    ViewBag.Title = "Index";
}
<input type="hidden" id="userId" value="@ViewBag.id" />
<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-sm-4">
        <h2>Index</h2>
        <ol class="breadcrumb">
            <li class="active">
                <strong>AspNetUser</strong>
            </li>
        </ol>
    </div>
</div>


<div class="wrapper wrapper-content">
    <div class="row animated fadeInRight">

        this is data bind:
        <div data-bind="foreach:showProfile">
            <div data-bind="text:UserName">

            </div>
            <div data-bind="text:Email"></div>
            <form action="#">
                <input type="file" />
                <input type="submit" />
            </form>
        </div>

            <div class="col-md-4">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <h5>Profile Detail</h5>
                    </div>
                    <div>
                        <div class="ibox-content no-padding border-left-right">
                            <img alt="image" class="img-responsive" src="~/Images/profile_big.jpg">
                        </div>
                        <div class="ibox-content profile-content">
                            <h4><strong>Monica Smith</strong></h4>
                            <p><i class="fa fa-map-marker"></i> Riviera State 32/106</p>
                            <h5>
                                About me
                            </h5>
                            <p>
                                Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitat.
                            </p>
                            <div class="row m-t-lg">
                                <div class="col-md-4">
                                    <span class="bar">5,3,9,6,5,9,7,3,5,2</span>
                                    <h5><strong>169</strong> Posts</h5>
                                </div>
                                <div class="col-md-4">
                                    <span class="line">5,3,9,6,5,9,7,3,5,2</span>
                                    <h5><strong>28</strong> Following</h5>
                                </div>
                                <div class="col-md-4">
                                    <span class="bar">5,3,2,-1,-3,-2,2,3,5,2</span>
                                    <h5><strong>240</strong> Followers</h5>
                                </div>
                            </div>
                            <div class="user-button">
                                <div class="row">
                                    <div class="col-md-6">
                                        <button type="button" class="btn btn-primary btn-sm btn-block"><i class="fa fa-envelope"></i> Send Message</button>
                                    </div>
                                    <div class="col-md-6">
                                        <button type="button" class="btn btn-default btn-sm btn-block"><i class="fa fa-coffee"></i> Buy a coffee</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-8">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <h5>Activites</h5>
                        <div class="ibox-tools">
                            <a class="collapse-link">
                                <i class="fa fa-chevron-up"></i>
                            </a>
                            <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                                <i class="fa fa-wrench"></i>
                            </a>
                            <ul class="dropdown-menu dropdown-user">
                                <li>
                                    <a href="#">Config option 1</a>
                                </li>
                                <li>
                                    <a href="#">Config option 2</a>
                                </li>
                            </ul>
                            <a class="close-link">
                                <i class="fa fa-times"></i>
                            </a>
                        </div>
                    </div>
                    <div class="ibox-content">

                        <div>
                            <div class="feed-activity-list">

                                <div class="feed-element">
                                    <a href="#" class="pull-left">
                                        <img alt="image" class="img-circle" src="~/Images/a1.jpg">
                                    </a>
                                    <div class="media-body ">
                                        <small class="pull-right text-navy">1m ago</small>
                                        <strong>Sandra Momot</strong> started following <strong>Monica Smith</strong>. <br>
                                        <small class="text-muted">Today 4:21 pm - 12.06.2014</small>
                                        <div class="actions">
                                            <a class="btn btn-xs btn-white"><i class="fa fa-thumbs-up"></i> Like </a>
                                            <a class="btn btn-xs btn-danger"><i class="fa fa-heart"></i> Love</a>
                                        </div>
                                    </div>
                                </div>

                                <div class="feed-element">
                                    <a href="#" class="pull-left">
                                        <img alt="image" class="img-circle" src="~/Images/profile.jpg">
                                    </a>
                                    <div class="media-body ">
                                        <small class="pull-right">5m ago</small>
                                        <strong>Monica Smith</strong> posted a new blog. <br>
                                        <small class="text-muted">Today 5:60 pm - 12.06.2014</small>

                                    </div>
                                </div>

                                <div class="feed-element">
                                    <a href="#" class="pull-left">
                                        <img alt="image" class="img-circle" src="~/Images/a2.jpg">
                                    </a>
                                    <div class="media-body ">
                                        <small class="pull-right">2h ago</small>
                                        <strong>Mark Johnson</strong> posted message on <strong>Monica Smith</strong> site. <br>
                                        <small class="text-muted">Today 2:10 pm - 12.06.2014</small>
                                        <div class="well">
                                            Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s.
                                            Over the years, sometimes by accident, sometimes on purpose (injected humour and the like).
                                        </div>
                                        <div class="pull-right">
                                            <a class="btn btn-xs btn-white"><i class="fa fa-thumbs-up"></i> Like </a>
                                            <a class="btn btn-xs btn-white"><i class="fa fa-heart"></i> Love</a>
                                            <a class="btn btn-xs btn-primary"><i class="fa fa-pencil"></i> Message</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="feed-element">
                                    <a href="#" class="pull-left">
                                        <img alt="image" class="img-circle" src="~/Images/a3.jpg">
                                    </a>
                                    <div class="media-body ">
                                        <small class="pull-right">2h ago</small>
                                        <strong>Janet Rosowski</strong> add 1 photo on <strong>Monica Smith</strong>. <br>
                                        <small class="text-muted">2 days ago at 8:30am</small>
                                        <div class="photos">
                                            <a target="_blank" href="http://24.media.tumblr.com/20a9c501846f50c1271210639987000f/tumblr_n4vje69pJm1st5lhmo1_1280.jpg"> <img alt="image" class="feed-photo" src="~/Images/p1.jpg"></a>
                                            <a target="_blank" href="http://37.media.tumblr.com/9afe602b3e624aff6681b0b51f5a062b/tumblr_n4ef69szs71st5lhmo1_1280.jpg"> <img alt="image" class="feed-photo" src="~/Images/p3.jpg"></a>
                                        </div>
                                    </div>
                                </div>
                                <div class="feed-element">
                                    <a href="#" class="pull-left">
                                        <img alt="image" class="img-circle" src="~/Images/a4.jpg">
                                    </a>
                                    <div class="media-body ">
                                        <small class="pull-right text-navy">5h ago</small>
                                        <strong>Chris Johnatan Overtunk</strong> started following <strong>Monica Smith</strong>. <br>
                                        <small class="text-muted">Yesterday 1:21 pm - 11.06.2014</small>
                                        <div class="actions">
                                            <a class="btn btn-xs btn-white"><i class="fa fa-thumbs-up"></i> Like </a>
                                            <a class="btn btn-xs btn-white"><i class="fa fa-heart"></i> Love</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="feed-element">
                                    <a href="#" class="pull-left">
                                        <img alt="image" class="img-circle" src="~/Images/a5.jpg">
                                    </a>
                                    <div class="media-body ">
                                        <small class="pull-right">2h ago</small>
                                        <strong>Kim Smith</strong> posted message on <strong>Monica Smith</strong> site. <br>
                                        <small class="text-muted">Yesterday 5:20 pm - 12.06.2014</small>
                                        <div class="well">
                                            Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s.
                                            Over the years, sometimes by accident, sometimes on purpose (injected humour and the like).
                                        </div>
                                        <div class="pull-right">
                                            <a class="btn btn-xs btn-white"><i class="fa fa-thumbs-up"></i> Like </a>
                                        </div>
                                    </div>
                                </div>
                                <div class="feed-element">
                                    <a href="#" class="pull-left">
                                        <img alt="image" class="img-circle" src="~/Images/profile.jpg">
                                    </a>
                                    <div class="media-body ">
                                        <small class="pull-right">23h ago</small>
                                        <strong>Monica Smith</strong> love <strong>Kim Smith</strong>. <br>
                                        <small class="text-muted">2 days ago at 2:30 am - 11.06.2014</small>
                                    </div>
                                </div>
                                <div class="feed-element">
                                    <a href="#" class="pull-left">
                                        <img alt="image" class="img-circle" src="~/Images/a7.jpg">
                                    </a>
                                    <div class="media-body ">
                                        <small class="pull-right">46h ago</small>
                                        <strong>Mike Loreipsum</strong> started following <strong>Monica Smith</strong>. <br>
                                        <small class="text-muted">3 days ago at 7:58 pm - 10.06.2014</small>
                                    </div>
                                </div>
                            </div>

                            <button class="btn btn-primary btn-block m"><i class="fa fa-arrow-down"></i> Show More</button>

                        </div>

                    </div>
                </div>

            </div>
        </div>
    <div class="ibox float-e-margins">
        <div class="ibox-title  back-change">
            <h5>Image cropper <small>http://fengyuanchen.github.io/cropper/</small></h5>
            <div class="ibox-tools">
                <a class="collapse-link">
                    <i class="fa fa-chevron-up"></i>
                </a>
                <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                    <i class="fa fa-wrench"></i>
                </a>
                <ul class="dropdown-menu dropdown-user">
                    <li>
                        <a href="#">Config option 1</a>
                    </li>
                    <li>
                        <a href="#">Config option 2</a>
                    </li>
                </ul>
                <a class="close-link">
                    <i class="fa fa-times"></i>
                </a>
            </div>
        </div>
        <div class="ibox-content">
            <p>
                Crop image
            </p>
            <div class="row">
                <div class="col-md-6">
                    <div class="image-crop">
                        <img src="~/Images/p3.jpg">
                    </div>
                </div>
                <div class="col-md-6">
                    <h4>Preview image</h4>
                    <div class="img-preview img-preview-sm"></div>
                    <h4>&nbsp;</h4>
                    <div class="btn-group">
                        <form action="/User/saveProfilePic" method="post" id="setProfilePic" enctype="multipart/form-data">
                            <label title="Upload image file" for="inputImage" class="btn btn-primary">

                                <input type="file" accept="image/*" name="file" id="inputImage" class="hide">
                                Upload new image
                                <input type="submit" style="visibility:hidden" />

                            </label>
                        </form>
                        <button id="setProfilePicBtn" class="btn btn-primary" >Set as profile picture</button>
                    </div>
                    <h4>Other options</h4>
                    <div class="btn-group">
                        <button class="btn btn-white" id="zoomIn" type="button">Zoom In</button>
                        <button class="btn btn-white" id="zoomOut" type="button">Zoom Out</button>
                        <button class="btn btn-white" id="rotateLeft" type="button">Rotate Left</button>
                        <button class="btn btn-white" id="rotateRight" type="button">Rotate Right</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
@section Styles {

    @Styles.Render("~/plugins/toastrStyles")
@Styles.Render("~/plugins/imagecropperStyles")
}


@section Scripts{
    @Scripts.Render("~/plugins/toastr")
@Scripts.Render("~/plugins/imagecropper")
<script src="~/Scripts/jquery.timeago.js"></script>
<script src="~/Scripts/knockout-3.3.0.js"></script>

    <script>
        function profile(data) {
            var self = this;
            data = data || {};
            self.UserName = data.UserName;
            self.Email = data.Email;
        }
        function viewModel() {
            var self = this;
            self.showProfile = ko.observable();
            self.loadProfile = function () {
                var userId = $("#userId").val();
                $.ajax({
                    url: '/api/User/GetUser/' + userId,
                    dataType: "json",
                    contentType: "application/json",
                    cache: false,
                    type: 'GET',
                    success: function (data) {
                        var mape = $.map(data, function (item) { return new profile(item); });
                        self.showProfile(mape);
                    },
                    error: function () {
                        toastr.error("failed to load profile", "Error");
                    }
                })
            }
            self.loadProfile();
            return self;
        }
        function getTimeAgo(varDate) {
            if (varDate) {
                return $.timeago(varDate.toString().slice(-1) == 'Z' ? varDate : varDate + 'Z');
            }
            else {
                return '';
            }
        }
        $(function () {
            $('#setProfilePicBtn').prop('disabled', true);
            var $image = $(".image-crop > img")
            $($image).cropper({
                aspectRatio: 1.618,
                preview: ".img-preview",
                done: function (data) {
                    //toastr.info("fone");
                    $('#setProfilePicBtn').prop('disabled', false);
                }
            });

            var $inputImage = $("#inputImage");
            if (window.FileReader) {
                $inputImage.change(function () {
                    var fileReader = new FileReader(),
                            files = this.files,
                            file;

                    if (!files.length) {
                        return;
                    }

                    file = files[0];

                    if (/^image\/\w+$/.test(file.type)) {
                        fileReader.readAsDataURL(file);
                        fileReader.onload = function () {
                            $inputImage.val("");
                            $image.cropper("reset", true).cropper("replace", this.result);
                        };
                    } else {
                        showMessage("Please choose an image file.");
                    }
                });
            } else {
                $inputImage.addClass("hide");
            }

            $("#setProfilePicBtn").click(function () {
                //window.open($image.cropper("getDataURL"));
                $("#setProfilePic").submit();
                toastr.info("Your profile picture is changed successfully! Please refresh page to see changes");
            });

            $("#zoomIn").click(function () {
                $image.cropper("zoom", 0.1);
            });

            $("#zoomOut").click(function () {
                $image.cropper("zoom", -0.1);
            });

            $("#rotateLeft").click(function () {
                $image.cropper("rotate", 45);
            });

            $("#rotateRight").click(function () {
                $image.cropper("rotate", -45);
            });

            $("#setDrag").click(function () {
                $image.cropper("setDragMode", "crop");
            });

            ko.applyBindings(new viewModel());
        });
    </script>
}



